# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥—Ä–∞–π–≤–µ—Ä–∞ Logitech MX Master 3S

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–æ–±—â–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
2. [HID++ 2.0 –ü—Ä–æ—Ç–æ–∫–æ–ª](#hidpp-20-–ø—Ä–æ—Ç–æ–∫–æ–ª)
3. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–∫–µ—Ç–æ–≤](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø–∞–∫–µ—Ç–æ–≤)
4. [Feature Discovery](#feature-discovery)
5. [–†–∞–±–æ—Ç–∞ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º](#—Ä–∞–±–æ—Ç–∞-—Å-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º)
6. [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫)
7. [–ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥](#–ø—Ä–∏–º–µ—Ä—ã-–∫–æ–º–∞–Ω–¥)

---

## –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ                   ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ   CLI (logi-mx)      ‚îÇ   ‚îÇ   Daemon      ‚îÇ
         ‚îÇ  - info              ‚îÇ   ‚îÇ  - udev watch ‚îÇ
         ‚îÇ  - battery           ‚îÇ   ‚îÇ  - auto-apply ‚îÇ
         ‚îÇ  - set dpi/smart...  ‚îÇ   ‚îÇ               ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ                   ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ     Driver Library (logi-mx-driver)      ‚îÇ
         ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
         ‚îÇ  ‚îÇ  MX Master 3S Device               ‚îÇ  ‚îÇ
         ‚îÇ  ‚îÇ  - get_dpi(), set_dpi()            ‚îÇ  ‚îÇ
         ‚îÇ  ‚îÇ  - get_smartshift(), set_smart...  ‚îÇ  ‚îÇ
         ‚îÇ  ‚îÇ  - get_battery()                   ‚îÇ  ‚îÇ
         ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
         ‚îÇ                 ‚îÇ                         ‚îÇ
         ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
         ‚îÇ  ‚îÇ  HID++ Device Layer                ‚îÇ  ‚îÇ
         ‚îÇ  ‚îÇ  - send_command()                  ‚îÇ  ‚îÇ
         ‚îÇ  ‚îÇ  - get_feature_index()             ‚îÇ  ‚îÇ
         ‚îÇ  ‚îÇ  - retry logic, error handling     ‚îÇ  ‚îÇ
         ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
         ‚îÇ                 ‚îÇ                         ‚îÇ
         ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
         ‚îÇ  ‚îÇ  HID++ Packet Layer                ‚îÇ  ‚îÇ
         ‚îÇ  ‚îÇ  - Short/Long packet parsing       ‚îÇ  ‚îÇ
         ‚îÇ  ‚îÇ  - to_bytes() / from_bytes()       ‚îÇ  ‚îÇ
         ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ   hidapi (libhidapi-hidraw)              ‚îÇ
         ‚îÇ   - read/write to HID devices            ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ   Linux Kernel: /dev/hidraw2             ‚îÇ
         ‚îÇ   - Interface 2 (HID++)                  ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  Logi Bolt USB   ‚îÇ
                    ‚îÇ  Receiver        ‚îÇ
                    ‚îÇ  VID:046d        ‚îÇ
                    ‚îÇ  PID:c548        ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                             ‚îÇ RF 2.4GHz
                             ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  MX Master 3S    ‚îÇ
                    ‚îÇ  For Business    ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## HID++ 2.0 –ü—Ä–æ—Ç–æ–∫–æ–ª

### –ß—Ç–æ —Ç–∞–∫–æ–µ HID++?

HID++ (HID Plus Plus) - –ø—Ä–æ–ø—Ä–∏–µ—Ç–∞—Ä–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª Logitech –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏.
–†–∞–±–æ—Ç–∞–µ—Ç –ø–æ–≤–µ—Ä—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ USB HID.

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞:

- **Feature-based**: –ö–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0x2201 = Adjustable DPI)
- **Dynamic discovery**: –ò–Ω–¥–µ–∫—Å—ã —Ñ—É–Ω–∫—Ü–∏–π –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Root Feature (0x0000)
- **Two packet sizes**: Short (7 bytes) –∏ Long (20 bytes)
- **Software ID**: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º 0x05)
- **Device index**: –ù–æ–º–µ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ receiver (0xFF –¥–ª—è –ø—Ä–æ–≤–æ–¥–Ω—ã—Ö, 1-6 –¥–ª—è wireless)

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–∫–µ—Ç–æ–≤

### Short Packet (7 bytes)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 0x10 ‚îÇ DevIdx ‚îÇ FeatIdx ‚îÇ FuncID ‚îÇ SoftID ‚îÇ Parameters ‚îÇ
‚îÇ  1B  ‚îÇ   1B   ‚îÇ   1B    ‚îÇ   1B   ‚îÇ   1B   ‚îÇ    3B      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–ü—Ä–∏–º–µ—Ä: Ping —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å index 2
[0x10, 0x02, 0x00, 0x01, 0x05, 0x00, 0x00, 0x00]
  ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
  ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ          ‚îî‚îÄ Parameters
  ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ     ‚îî‚îÄ Software ID
  ‚îÇ     ‚îÇ     ‚îÇ     ‚îî‚îÄ Function ID: Ping (1)
  ‚îÇ     ‚îÇ     ‚îî‚îÄ Feature Index: Root (0)
  ‚îÇ     ‚îî‚îÄ Device Index: 2
  ‚îî‚îÄ Report ID: Short packet
```

### Long Packet (20 bytes)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 0x11 ‚îÇ DevIdx ‚îÇ FeatIdx ‚îÇ FuncID ‚îÇ SoftID ‚îÇ Parameters ‚îÇ
‚îÇ  1B  ‚îÇ   1B   ‚îÇ   1B    ‚îÇ   1B   ‚îÇ   1B   ‚îÇ   16B      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–ü—Ä–∏–º–µ—Ä: Get Device Name —Å offset 0
[0x11, 0x02, 0x03, 0x00, 0x05, 0x00, 0x00, 0x00, ...]
  ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
  ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ          ‚îî‚îÄ 15 –±–∞–π—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
  ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ     ‚îî‚îÄ Offset: 0
  ‚îÇ     ‚îÇ     ‚îÇ     ‚îÇ     ‚îî‚îÄ Software ID
  ‚îÇ     ‚îÇ     ‚îÇ     ‚îî‚îÄ Function: GetDeviceName (0)
  ‚îÇ     ‚îÇ     ‚îî‚îÄ Feature Index: DeviceName (3)
  ‚îÇ     ‚îî‚îÄ Device Index: 2
  ‚îî‚îÄ Report ID: Long packet
```

### Packet Error Response

–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ:

```
[0x8F, DevIdx, FeatureIdx, FuncID, SoftID, ErrorCode]
  ‚îÇ
  ‚îî‚îÄ 0x8F = Error marker
```

–ö–æ–¥—ã –æ—à–∏–±–æ–∫:
- `0x01` - Invalid SubID (–Ω–µ–≤–µ—Ä–Ω—ã–π function ID)
- `0x02` - Invalid Address
- `0x03` - Invalid Value
- `0x05` - Connection Failed
- `0x06` - Too Many Devices
- `0x07` - Already Exists
- `0x08` - Busy (—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∑–∞–Ω—è—Ç–æ)
- `0x09` - Unknown Device
- `0x0A` - Resource Error
- `0x0B` - Request Unavailable
- `0x0C` - Unsupported Parameter
- `0x0D` - Wrong PIN Code

---

## Feature Discovery

HID++ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π —á–µ—Ä–µ–∑ **Root Feature (0x0000)**.

### –ê–ª–≥–æ—Ä–∏—Ç–º:

1. **–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å GetFeature:**
   ```
   Feature Index: 0 (Root)
   Function ID: 0 (GetFeature)
   Parameters: [0x22, 0x01, 0x00]  // Feature ID 0x2201 (DPI)
   ```

2. **–ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç:**
   ```
   Parameters: [0x0D, 0x00, 0x02]
                 ‚îÇ     ‚îÇ     ‚îî‚îÄ Version: 2
                 ‚îÇ     ‚îî‚îÄ Type flags
                 ‚îî‚îÄ Feature Index: 13
   ```

3. **–ö–µ—à–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   ```rust
   feature_cache.insert(0x2201, 13);
   ```

### –ö–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

```rust
pub fn get_feature_index(&mut self, feature_id: u16) -> Result<u8> {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–µ—à
    if let Some(&index) = self.feature_cache.get(&feature_id) {
        return Ok(index);
    }

    // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    let params = [(feature_id >> 8) as u8, (feature_id & 0xFF) as u8, 0x00];
    let response = self.send_command(ROOT_INDEX, RootFunction::GetFeature as u8, &params)?;

    // –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–Ω–¥–µ–∫—Å –∏–∑ –æ—Ç–≤–µ—Ç–∞
    let index = match response {
        HidppPacket::Short(p) => p.parameters[0],
        HidppPacket::Long(p) => p.parameters[0]
    };

    if index == 0 {
        return Err(DeviceErrorKind::UnsupportedFeature.into());
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫–µ—à
    self.feature_cache.insert(feature_id, index);
    debug!("Feature {:04x} mapped to index {}", feature_id, index);

    Ok(index)
}
```

---

## –†–∞–±–æ—Ç–∞ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º

### –û—Ç–∫—Ä—ã—Ç–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

```rust
// driver/src/hidpp/device.rs:45
pub fn open_vid_pid(vendor_id: u16, product_id: u16, device_index: u8) -> Result<Self> {
    let api = HidApi::new()?;

    // –ò—â–µ–º interface 2 (HID++ interface)
    let mut target_path = None;
    for device_info in api.device_list() {
        if device_info.vendor_id() == vendor_id
           && device_info.product_id() == product_id {
            if device_info.interface_number() == 2 || device_info.interface_number() == -1 {
                target_path = Some(device_info.path().to_owned());
                break;
            }
        }
    }

    let path = target_path.ok_or(...)?;
    let device = api.open_path(&path)?;

    Ok(Self {
        device,
        device_index,
        feature_cache: HashMap::new(),
        software_id: 0x05
    })
}
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã —Å –∞–≤—Ç–æ–ø–æ–≤—Ç–æ—Ä–æ–º

```rust
pub fn send_command(
    &mut self,
    feature_index: u8,
    function_id: u8,
    params: &[u8]
) -> Result<HidppPacket> {
    // –í—ã–±–∏—Ä–∞–µ–º —Ç–∏–ø –ø–∞–∫–µ—Ç–∞
    let packet = if params.len() <= 3 {
        HidppPacket::new_short(self.device_index, feature_index, function_id,
                               self.software_id, parameters)
    } else if params.len() <= 16 {
        HidppPacket::new_long(self.device_index, feature_index, function_id,
                              self.software_id, parameters)
    } else {
        return Err(AppError::bad_request("Parameters too long"));
    };

    // –ü—Ä–æ–±—É–µ–º 3 —Ä–∞–∑–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
    for attempt in 0..RETRY_COUNT {
        match self.send_packet_with_response(&packet) {
            Ok(response) => {
                if response.is_error() {
                    if let Some(error_code) = response.get_error_code() {
                        if error_code == ERROR_BUSY && attempt < RETRY_COUNT - 1 {
                            warn!("Device busy, retrying... (attempt {})", attempt + 1);
                            std::thread::sleep(Duration::from_millis(50));
                            continue;
                        }
                        return Err(self.map_hidpp_error(error_code));
                    }
                }
                return Ok(response);
            }
            Err(e) if attempt < RETRY_COUNT - 1 => {
                warn!("Command failed, retrying... (attempt {})", attempt + 1);
                std::thread::sleep(Duration::from_millis(50));
                continue;
            }
            Err(e) => return Err(e)
        }
    }

    Err(DeviceErrorKind::CommandFailed.into())
}
```

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ò–µ—Ä–∞—Ä—Ö–∏—è –æ—à–∏–±–æ–∫

```rust
pub enum DeviceErrorKind {
    NotFound,              // –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
    ConnectionFailed,      // –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    InvalidResponse,       // –ù–µ–≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    UnsupportedFeature,    // –§—É–Ω–∫—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
    CommandFailed,         // –ö–æ–º–∞–Ω–¥–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
    Timeout               // –¢–∞–π–º–∞—É—Ç –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
}
```

### –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ HID++ –æ—à–∏–±–æ–∫

```rust
fn map_hidpp_error(&self, error_code: u8) -> AppError {
    match error_code {
        ERROR_INVALID_SUBID => AppError::bad_request("Invalid function ID"),
        ERROR_INVALID_ADDRESS => AppError::bad_request("Invalid address"),
        ERROR_INVALID_VALUE => AppError::bad_request("Invalid value"),
        ERROR_CONNECT_FAIL => AppError::internal("Connection failed"),
        ERROR_TOO_MANY_DEVICES => AppError::conflict("Too many devices"),
        ERROR_ALREADY_EXISTS => AppError::conflict("Already exists"),
        ERROR_BUSY => AppError::internal("Device busy"),
        ERROR_UNKNOWN_DEVICE => AppError::not_found("Unknown device"),
        ERROR_RESOURCE_ERROR => AppError::internal("Resource error"),
        ERROR_REQUEST_UNAVAILABLE => AppError::bad_request("Request unavailable"),
        ERROR_UNSUPPORTED_PARAM => AppError::bad_request("Unsupported parameter"),
        ERROR_WRONG_PIN_CODE => AppError::unauthorized("Wrong PIN code"),
        _ => AppError::internal("Unknown HID++ error")
            .with_field(field::u64("error_code", error_code as u64))
    }
}
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ DPI

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Command: Set DPI to 1800 (0x0708)                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Step 1: Get feature index for 0x2201 (Adjustable DPI)
  ‚Üí [0x10, 0x02, 0x00, 0x00, 0x05, 0x22, 0x01, 0x00]
  ‚Üê [0x11, 0x02, 0x00, 0x00, 0x05, 0x0D, 0x00, 0x02, ...]
     Feature index = 13 (0x0D)

Step 2: Set DPI value
  ‚Üí [0x10, 0x02, 0x0D, 0x03, 0x05, 0x00, 0x07, 0x08]
                  ‚îÇ     ‚îÇ              ‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ DPI: 1800
                  ‚îÇ     ‚îÇ              ‚îî‚îÄ‚îÄ Sensor ID: 0
                  ‚îÇ     ‚îî‚îÄ‚îÄ Function: SetSensorDpi (3)
                  ‚îî‚îÄ‚îÄ Feature Index: 13
  ‚Üê ACK or error response
```

**–ö–æ–¥:**

```rust
fn set_dpi(&mut self, dpi: u16) -> Result<()> {
    let feature_index = self.hidpp.get_feature_index(FEATURE_ADJUSTABLE_DPI)?;

    // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: [sensor_id, dpi_hi, dpi_lo]
    let params = [0x00, (dpi >> 8) as u8, (dpi & 0xFF) as u8];

    self.hidpp.send_command(
        feature_index,
        DpiFunction::SetSensorDpi as u8,
        &params
    )?;

    Ok(())
}
```

### 2. SmartShift (Feature 0x2110)

SmartShift —É–ø—Ä–∞–≤–ª—è–µ—Ç –º–æ—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–π —Ç—Ä–µ—â–æ—Ç–∫–æ–π –∫–æ–ª–µ—Å–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏.

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Command: Enable SmartShift with threshold 30                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Step 1: Get feature index for 0x2110
  ‚Üí [0x10, 0x02, 0x00, 0x00, 0x05, 0x21, 0x10, 0x00]
  ‚Üê [0x11, 0x02, 0x00, 0x00, 0x05, 0x0E, 0x00, 0x01, ...]
     Feature index = 14 (0x0E)

Step 2: Set ratchet control mode
  ‚Üí [0x10, 0x02, 0x0E, 0x01, 0x05, 0x02, 0x1E, 0x00]
                  ‚îÇ     ‚îÇ              ‚îÇ     ‚îÇ     ‚îî‚îÄ‚îÄ Default: no change
                  ‚îÇ     ‚îÇ              ‚îÇ     ‚îî‚îÄ‚îÄ Threshold: 30 (0x1E)
                  ‚îÇ     ‚îÇ              ‚îî‚îÄ‚îÄ Wheel Mode: 2 (Ratchet)
                  ‚îÇ     ‚îî‚îÄ‚îÄ Function: SetRatchetControlMode (1)
                  ‚îî‚îÄ‚îÄ Feature Index: 14
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

- **Byte 0 (wheelMode):**
  - `0x00` = No change
  - `0x01` = Freespin (—Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–∞—â–µ–Ω–∏–µ)
  - `0x02` = Ratchet (—Å —Ç—Ä–µ—â–æ—Ç–∫–æ–π)

- **Byte 1 (autoDisengage):**
  - `0x00` = No change
  - `0x01-0xFE` = Threshold (—Å–∫–æ—Ä–æ—Å—Ç—å –¥–ª—è –∞–≤—Ç–æ–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤ —á–µ—Ç–≤–µ—Ä—Ç—å–æ–±–æ—Ä–æ—Ç–∞—Ö/—Å–µ–∫)
  - `0xFF` = Always engaged (–≤—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–µ–Ω–æ, –±–µ–∑ –∞–≤—Ç–æ–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è)

- **Byte 2 (autoDisengageDefault):**
  - `0x00` = No change
  - `0x01-0xFE` = Default threshold
  - `0xFF` = Always engaged

**–ö–æ–¥:**

```rust
fn set_smartshift(&mut self, config: SmartShiftConfig) -> Result<()> {
    let feature_index = self.hidpp.get_feature_index(FEATURE_SMART_SHIFT)?;

    let wheel_mode = 0x02;  // Always ratchet mode
    let auto_disengage = if config.enabled && config.threshold > 0 {
        config.threshold
    } else {
        0xFF  // Disabled (always engaged, no auto-switch)
    };
    let auto_disengage_default = 0x00;  // No change to persistent default

    let params = [wheel_mode, auto_disengage, auto_disengage_default];

    self.hidpp.send_command(
        feature_index,
        SmartShiftFunction::SetRatchetControlMode as u8,
        &params
    )?;

    Ok(())
}
```

### 3. –ë–∞—Ç–∞—Ä–µ—è (Feature 0x1004/0x1000)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Command: Get Battery Status                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Step 1: Try Unified Battery (0x1004)
  ‚Üí [0x10, 0x02, 0x00, 0x00, 0x05, 0x10, 0x04, 0x00]
  ‚Üê [0x11, 0x02, 0x00, 0x00, 0x05, 0x0C, 0x00, 0x00, ...]
     Feature index = 12

Step 2: Get battery status
  ‚Üí [0x10, 0x02, 0x0C, 0x00, 0x05, 0x00, 0x00, 0x00]
  ‚Üê [0x11, 0x02, 0x0C, 0x00, 0x05, 0x0F, 0x00, 0x00, ...]
                                    ‚îÇ     ‚îî‚îÄ‚îÄ Status: 0=Discharging
                                    ‚îî‚îÄ‚îÄ Level: 15%
```

**Status Codes:**

- `0` = Discharging
- `1` = Charging
- `2` = Full

**–ö–æ–¥:**

```rust
fn get_battery_unified(&mut self) -> Result<BatteryInfo> {
    let feature_index = self.hidpp.get_feature_index(FEATURE_UNIFIED_BATTERY)?;

    let response = self.hidpp.send_command(
        feature_index,
        BatteryFunction::GetStatus as u8,
        &[]
    )?;

    let (level, status_byte) = match response {
        HidppPacket::Short(p) => (p.parameters[0], p.parameters[1]),
        HidppPacket::Long(p) => (p.parameters[0], p.parameters[1])
    };

    let status = match status_byte {
        0 => BatteryStatus::Discharging,
        1 => BatteryStatus::Charging,
        2 => BatteryStatus::Full,
        _ => BatteryStatus::Unknown
    };

    Ok(BatteryInfo { level, status })
}
```

---

## –¢–∞–±–ª–∏—Ü–∞ Feature ID

| Feature ID | –ù–∞–∑–≤–∞–Ω–∏–µ              | –§—É–Ω–∫—Ü–∏–∏                                    |
|------------|-----------------------|--------------------------------------------|
| `0x0000`   | Root                  | 0:GetFeature, 1:Ping                       |
| `0x0005`   | Device Name           | 0:GetDeviceName                            |
| `0x1000`   | Battery Status        | 0:GetStatus, 1:GetCapability               |
| `0x1004`   | Unified Battery       | 0:GetStatus, 1:GetCapability               |
| `0x2110`   | SmartShift            | 0:GetRatchetControlMode, 1:SetRatchet...   |
| `0x2121`   | Hi-Res Wheel          | 0:GetCapabilities, 1:GetMode, 2:SetMode    |
| `0x2201`   | Adjustable DPI        | 0:GetSensorCount, 2:GetSensorDpi, 3:Set... |
| `0x1B04`   | Reprog Controls v4    | 0:GetControlCount, 1:GetControlInfo, ...   |

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥ (–Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ):**

```bash
$ time ./target/release/logi-mx info > /dev/null
real    0m0.965s
user    0m0.007s
sys     0m0.007s

$ time ./target/release/logi-mx set dpi 2000
real    0m0.889s
user    0m0.006s
sys     0m0.006s
```

**–ó–∞–¥–µ—Ä–∂–∫–∏:**
- –û—Ç–∫—Ä—ã—Ç–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: ~20ms
- Feature discovery (–ø–µ—Ä–≤—ã–π —Ä–∞–∑): ~20ms –Ω–∞ feature
- Feature discovery (cached): <1ms
- –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã: ~15-25ms
- Retry –ø—Ä–∏ –æ—à–∏–±–∫–µ: 50ms –∑–∞–¥–µ—Ä–∂–∫–∞

---

## –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ USB –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

Logi Bolt Receiver (046d:c548) –∏–º–µ–µ—Ç 3 –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:

```
Interface 0: Mouse HID (standard)
  - /dev/hidraw0
  - –û–±—ã—á–Ω—ã–µ mouse events (–¥–≤–∏–∂–µ–Ω–∏–µ, –∫–ª–∏–∫–∏)

Interface 1: Keyboard HID (standard)
  - /dev/hidraw1
  - Keyboard events –æ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä –≤ receiver

Interface 2: HID++ Protocol
  - /dev/hidraw2  ‚Üê –ò—Å–ø–æ–ª—å–∑—É–µ–º —ç—Ç–æ—Ç!
  - –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è (DPI, SmartShift, etc.)
```

**–í–∞–∂–Ω–æ:** –î—Ä–∞–π–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç interface 2 –ø–æ `interface_number() == 2`.

---

## Zero-Cost Abstractions

–î—Ä–∞–π–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã Rust –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

- **Enum dispatch –≤–º–µ—Å—Ç–æ trait objects**: `HidppPacket::Short/Long` –±–µ–∑ vtable
- **inline-always** –¥–ª—è –≥–æ—Ä—è—á–∏—Ö –ø—É—Ç–µ–π: `to_bytes()`, `from_bytes()`
- **Stack allocation**: –ë—É—Ñ–µ—Ä—ã —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –±–µ–∑ heap
- **Feature cache**: HashMap –¥–ª—è O(1) lookup –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- **LTO + single codegen unit**: –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤ release

---

## Troubleshooting

### –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å USB —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
lsusb | grep Logitech

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å hidraw —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
ls -la /dev/hidraw*

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å udev –ø—Ä–∞–≤–∏–ª–∞
cat /etc/udev/rules.d/90-logi-mx.rules

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å udev
sudo udevadm control --reload-rules
sudo udevadm trigger
```

### –ö–æ–º–∞–Ω–¥—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

```bash
# –í–∫–ª—é—á–∏—Ç—å trace –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
RUST_LOG=trace ./target/release/logi-mx info

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
udevadm info /dev/hidraw2 | grep INTERFACE
```

### –ë–∞—Ç–∞—Ä–µ—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç Unknown

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–∞—Ä—ã–µ –º—ã—à–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç legacy battery protocol (feature 0x1000 –≤–º–µ—Å—Ç–æ 0x1004).
–î—Ä–∞–π–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–±—É–µ—Ç –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ —á–µ—Ä–µ–∑ `get_battery_unified().or_else(|_| get_battery_legacy())`.

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **HID++ –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏**: https://lekensteyn.nl/logitech-unifying.html
- **Solaar (reference implementation)**: https://github.com/pwr-Solaar/Solaar
- **libratbag**: https://github.com/libratbag/libratbag
- **HID Usage Tables**: https://usb.org/hid

---

**–î–∞—Ç–∞**: 2025-11-11
**–í–µ—Ä—Å–∏—è –¥—Ä–∞–π–≤–µ—Ä–∞**: 0.1.0
**Rust Edition**: 2024
